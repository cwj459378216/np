<div>
    <ul class="flex space-x-2 rtl:space-x-reverse">
        <li>
            <a href="javascript:;" class="text-primary hover:underline">{{ 'navigation.report' | translate }}</a>
        </li>
        <li class="before:mr-2 before:content-['/'] rtl:before:ml-2">
            <span>{{ 'Report Scheduler' | translate }}</span>
        </li>
    </ul>

    <div class="pt-5">
        <div>
            <div class="flex flex-wrap items-center justify-between gap-4">
                <h2 class="text-xl"></h2>
                <div class="flex w-full flex-col gap-4 sm:w-auto sm:flex-row sm:items-center sm:gap-3">
                    <div class="flex gap-3">
                        <div>
                            <button type="button" class="btn btn-primary" (click)="editScheduler()">
                                {{ 'Add Schedule' | translate }}
                            </button>
                        </div>
                        <!-- <div>
                            <button type="button" class="btn btn-outline-primary p-2"
                                [ngClass]="{ 'bg-primary text-white': displayType === 'list' }"
                                (click)="displayType = 'list'">
                                <icon-list-check />
                            </button>
                        </div>
                        <div>
                            <button type="button" class="btn btn-outline-primary p-2"
                                [ngClass]="{ 'bg-primary text-white': displayType === 'grid' }"
                                (click)="displayType = 'grid'">
                                <icon-layout-grid />
                            </button>
                        </div> -->
                    </div>

                    <div class="relative">
                        <input type="text" placeholder="{{ 'Search Schedules' | translate }}"
                            class="peer form-input py-2 ltr:pr-11 rtl:pl-11" [(ngModel)]="searchText"
                            (ngModelChange)="searchSchedulers()" />
                        <div class="absolute top-1/2 -translate-y-1/2 peer-focus:text-primary ltr:right-[11px] rtl:left-[11px]">
                            <icon-search class="mx-auto" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel mt-5 overflow-hidden border-0 p-0">
                <div class="table-responsive">
                    <table class="table-striped table-hover">
                        <thead>
                            <tr>
                                <th>{{ 'Name' | translate }}</th>
                                <th>{{ 'Description' | translate }}</th>
                                <th>{{ 'templates.templates' | translate }}</th>
                                <th>{{ 'templates.frequency' | translate }}</th>
                                <th>{{ 'templates.time' | translate }}</th>
                                <th>{{ 'Where to Send' | translate }}</th>
                                <th>{{ 'Status' | translate }}</th>
                                <th>{{ 'roles.createdAt' | translate }}</th>
                                <th class="!text-center">{{ 'Actions' | translate }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let scheduler of filteredSchedulers">
                                <td>{{ scheduler.name }}</td>
                                <td>{{ scheduler.description }}</td>
                                <td>{{ getTemplateLabel(scheduler.template) }}</td>
                                <td>{{ getFrequencyLabel(scheduler.frequency) }}</td>
                                <td>{{ formatTime(scheduler.time) }}</td>
                                <td>{{ getWhereToSendLabel(scheduler.whereToSend) }}</td>
                                <td>
                                    <label class="w-12 h-6 relative inline-block">
                                        <input type="checkbox" class="custom_switch absolute w-full h-full opacity-0 z-10 cursor-pointer peer"
                                            [checked]="scheduler.status === 'Active'" (change)="toggleSchedulerStatus(scheduler, $event)" />
                                        <span class="outline_checkbox bg-icon border-2 border-[#ebedf2] dark:border-white-dark block h-full rounded-full before:absolute before:left-1 before:bg-[#ebedf2] dark:before:bg-white-dark before:bottom-1 before:w-4 before:h-4 before:rounded-full before:bg-[url(/assets/images/close.svg)] before:bg-no-repeat before:bg-center peer-checked:before:left-7 peer-checked:before:bg-[url(/assets/images/checked.svg)] peer-checked:border-primary peer-checked:before:bg-primary before:transition-all before:duration-300"></span>
                                    </label>
                                </td>
                                <td>{{ formatDate(scheduler.createdAt) }}</td>
                                <td>
                                    <div class="flex items-center justify-center gap-4">
                                        <button type="button" class="btn btn-sm btn-outline-success relative"
                                            [disabled]="isExecuting(scheduler.id)"
                                            (click)="executeScheduler(scheduler)" title="Execute Now">
                                            <ng-container *ngIf="!isExecuting(scheduler.id); else loadingIcon">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M8 5V3C8 2.44772 8.44772 2 9 2H15C15.5523 2 16 2.44772 16 3V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    <path d="M12 12L16 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    <path d="M8 8L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    <rect x="4" y="5" width="16" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                                                </svg>
                                            </ng-container>
                                            <ng-template #loadingIcon>
                                                <svg class="animate-spin" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                                                </svg>
                                            </ng-template>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            (click)="editScheduler(scheduler)">{{ 'general.edit' | translate }}</button>
                                        <button type="button" class="btn btn-sm btn-outline-danger"
                                            (click)="deleteScheduler(scheduler)">{{ 'general.delete' | translate }}</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <ngx-custom-modal #addSchedulerModal class="no-footer">
        <ng-template #modalHeader>
            <div class="!font-medium">{{ params.controls['id'].value ? ('Edit Schedule' | translate) : ('Add Schedule' | translate) }}</div>
        </ng-template>
        <ng-template #modalBody>
            <form [formGroup]="params" class="text-sm" (ngSubmit)="saveScheduler()" ngNativeValidate>
                <div class="mb-5">
                    <label for="name">{{ 'Name' | translate }} <span class="text-danger">*</span></label>
                    <input id="name" type="text" formControlName="name" class="form-input"
                           [class.border-danger]="params.get('name')?.invalid && params.get('name')?.touched" required />
                    <div *ngIf="params.get('name')?.invalid && params.get('name')?.touched" class="text-danger text-xs mt-1">
                        <div *ngIf="params.get('name')?.errors?.['required']">{{ 'validation.required' | translate }}</div>
                        <div *ngIf="params.get('name')?.errors?.['minlength']">{{ 'validation.minLength' | translate:'{length: 2}' }}</div>
                    </div>
                </div>
                <div class="mb-5">
                    <label for="description">{{ 'Description' | translate }} <span class="text-danger">*</span></label>
                    <textarea id="description" formControlName="description" class="form-input" rows="3"
                              [class.border-danger]="params.get('description')?.invalid && params.get('description')?.touched" required></textarea>
                    <div *ngIf="params.get('description')?.invalid && params.get('description')?.touched" class="text-danger text-xs mt-1">
                        <div *ngIf="params.get('description')?.errors?.['required']">{{ 'validation.required' | translate }}</div>
                        <div *ngIf="params.get('description')?.errors?.['minlength']">{{ 'validation.minLength' | translate:'{length: 5}' }}</div>
                    </div>
                </div>
                <div class="mb-5">
                    <label for="template">{{ 'templates.templates' | translate }} <span class="text-danger">*</span></label>
                    <select id="template" formControlName="template" class="form-select"
                            [class.border-danger]="params.get('template')?.invalid && params.get('template')?.touched" required>
                        <option value="">{{ 'Select Template' | translate }}</option>
                        <option *ngFor="let option of templateOptions" [value]="option.value">
                            {{ option.label }}
                        </option>
                    </select>
                    <div *ngIf="params.get('template')?.invalid && params.get('template')?.touched" class="text-danger text-xs mt-1">
                        <div *ngIf="params.get('template')?.errors?.['required']">{{ 'validation.required' | translate }}</div>
                    </div>
                </div>
                <div class="mb-5">
                    <label for="frequency">{{ 'templates.frequency' | translate }} <span class="text-danger">*</span></label>
                    <select id="frequency" formControlName="frequency" class="form-select"
                            [class.border-danger]="params.get('frequency')?.invalid && params.get('frequency')?.touched" required>
                        <option value="">{{ 'Select Frequency' | translate }}</option>
                        <option value="Daily">{{ 'common.Daily' | translate }}</option>
                        <option value="Weekly">{{ 'common.Weekly' | translate }}</option>
                        <option value="Monthly">{{ 'common.Monthly' | translate }}</option>
                    </select>
                    <div *ngIf="params.get('frequency')?.invalid && params.get('frequency')?.touched" class="text-danger text-xs mt-1">
                        <div *ngIf="params.get('frequency')?.errors?.['required']">{{ 'validation.required' | translate }}</div>
                    </div>
                </div>
                <div class="mb-5">
                    <label for="time">{{ 'templates.time' | translate }} <span class="text-danger">*</span></label>
                    <input id="time" type="time" formControlName="time" class="form-input"
                           [class.border-danger]="params.get('time')?.invalid && params.get('time')?.touched" required />
                    <div *ngIf="params.get('time')?.invalid && params.get('time')?.touched" class="text-danger text-xs mt-1">
                        <div *ngIf="params.get('time')?.errors?.['required']">{{ 'validation.required' | translate }}</div>
                    </div>
                </div>
                <div class="mb-5">
                    <label for="whereToSend">{{ 'Where to Send' | translate }} <span class="text-danger">*</span></label>
                    <select
                        id="whereToSend"
                        formControlName="whereToSend"
                        class="form-select"
                        [class.border-danger]="params.get('whereToSend')?.invalid && params.get('whereToSend')?.touched"
                        required
                    >
                        <option value="">{{ 'Select Destination' | translate }}</option>
                        <option *ngFor="let option of whereToSendOptions" [value]="option.value">
                            {{ option.label }}
                        </option>
                    </select>
                    <div *ngIf="params.get('whereToSend')?.invalid && params.get('whereToSend')?.touched" class="text-danger text-xs mt-1">
                        <div *ngIf="params.get('whereToSend')?.errors?.['required']">{{ 'validation.required' | translate }}</div>
                    </div>
                </div>
                <div class="mb-5">
                    <label for="status">{{ 'Status' | translate }}</label>
                    <select id="status" formControlName="status" class="form-select" required>
                        <option value="Active">{{ 'users.active' | translate }}</option>
                        <option value="Inactive">{{ 'users.inactive' | translate }}</option>
                    </select>
                </div>
                <div class="mt-8 flex items-center justify-end">
                    <button type="button" class="btn btn-outline-danger" (click)="addSchedulerModal.close()">{{ 'Cancel' | translate }}</button>
                    <button type="submit" class="btn btn-primary ltr:ml-4 rtl:mr-4" [disabled]="params.invalid">
                        {{ params.controls['id'].value ? ('Update' | translate) : ('Add' | translate) }}
                    </button>
                </div>
            </form>
        </ng-template>
    </ngx-custom-modal>
</div>
