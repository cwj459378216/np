<div>
    <div
        class="fixed inset-0 z-[51] hidden bg-[black]/60 px-4 transition-[display]"
        [ngClass]="{ '!block': showCustomizer }"
        (click)="showCustomizer = false"
    ></div>

    <nav
        class="fixed bottom-0 top-0 z-[51] w-full max-w-[400px] bg-white p-4 shadow-[5px_0_25px_0_rgba(94,92,154,0.1)] transition-[right] duration-300 ltr:-right-[400px] rtl:-left-[400px] dark:bg-[#0e1726]"
        [ngClass]="{ 'ltr:!right-0 rtl:!left-0': showCustomizer }"
    >
        <a
            href="javascript:;"
            class="absolute bottom-0 top-0 my-auto flex h-10 w-12 cursor-pointer items-center justify-center bg-primary text-white ltr:-left-12 ltr:rounded-bl-full ltr:rounded-tl-full rtl:-right-12 rtl:rounded-br-full rtl:rounded-tr-full"
            (click)="showCustomizer = !showCustomizer"
        >
            <icon-message class="h-5 w-5" />
        </a>
        <ng-scrollbar class="relative h-full overflow-x-hidden ltr:-mr-3 ltr:pr-3 rtl:-ml-3 rtl:pl-3">
            <div>
                <div class="relative pb-5 text-center">
                    <a
                        href="javascript:;"
                        class="absolute top-0 opacity-30 hover:opacity-100 ltr:right-0 rtl:left-0 dark:text-white"
                        (click)="showCustomizer = false"
                    >
                        <icon-x class="h-5 w-5" />
                    </a>
                    <h4 class="mb-1 dark:text-white">AI 助手</h4>
                    <p class="text-white-dark">与AI助手进行对话，获取帮助和建议</p>
                </div>

                <!-- Chat Messages Container -->
                <div #chatContainer class="mb-4 h-96 overflow-y-auto rounded-md border border-[#e0e6ed] p-3 dark:border-[#1b2e4b]">
                    <div *ngFor="let message of chatMessages" class="mb-3">
                        <div *ngIf="message.isUser" class="flex justify-end">
                            <div class="max-w-[80%] rounded-lg bg-primary p-3 text-white">
                                <p class="text-sm">{{ message.content }}</p>
                                <span class="text-xs opacity-70">{{ message.timestamp | date:'HH:mm' }}</span>
                            </div>
                        </div>
                        <div *ngIf="!message.isUser" class="flex justify-start">
                            <div class="max-w-[80%] rounded-lg bg-gray-100 p-3 dark:bg-[#1b2e4b] dark:text-white">
                                <p class="text-sm">{{ message.content }}</p>
                                <span class="text-xs opacity-70">{{ message.timestamp | date:'HH:mm' }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Loading indicator -->
                    <div *ngIf="isLoading" class="flex justify-start">
                        <div class="max-w-[80%] rounded-lg bg-gray-100 p-3 dark:bg-[#1b2e4b] dark:text-white">
                            <div class="flex items-center space-x-2">
                                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-primary"></div>
                                <span class="text-sm">AI正在思考...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="rounded-md border border-[#e0e6ed] p-3 dark:border-[#1b2e4b]">
                    <div class="flex space-x-2">
                        <input
                            type="text"
                            [(ngModel)]="userInput"
                            (keyup.enter)="sendMessage()"
                            placeholder="输入您的问题..."
                            class="form-input flex-1 border-0 focus:ring-0 dark:bg-[#1b2e4b] dark:text-white"
                            [disabled]="isLoading"
                        />
                        <button
                            type="button"
                            class="btn btn-primary"
                            (click)="sendMessage()"
                            [disabled]="!userInput.trim() || isLoading"
                        >
                            <icon-send class="h-4 w-4" />
                        </button>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="mt-3 rounded-md border border-[#e0e6ed] p-3 dark:border-[#1b2e4b]">
                    <h5 class="mb-2 text-sm font-medium dark:text-white">快速问题</h5>
                    <div class="flex flex-wrap gap-2">
                        <button
                            *ngFor="let quickQuestion of quickQuestions"
                            type="button"
                            class="btn btn-outline-primary btn-sm"
                            (click)="sendQuickQuestion(quickQuestion)"
                            [disabled]="isLoading"
                        >
                            {{ quickQuestion }}
                        </button>
                    </div>
                </div>
            </div>
        </ng-scrollbar>
    </nav>
</div>
